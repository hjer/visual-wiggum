<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}spec-view{% endblock %}</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/htmx.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <a href="/" class="nav-brand">
            spec-view
            <span class="live-dot" id="live-dot" title="Live updates active"></span>
        </a>
        <div class="nav-links">
            <a href="/" class="nav-link">Dashboard</a>
            <a href="/tasks" class="nav-link">Tasks</a>
            <a href="/history" class="nav-link">History</a>
        </div>
    </nav>
    <main class="container">
        {% block content %}{% endblock %}
    </main>
    <div class="global-progress-bar"
         hx-get="/partials/global-progress"
         hx-trigger="load, specchange from:body"
         hx-swap="innerHTML">
    </div>
    <script>
    (function() {
        var dot = document.getElementById('live-dot');
        var evtSource = new EventSource('/events');
        evtSource.addEventListener('specchange', function() {
            htmx.trigger(document.body, 'specchange');
            dot.classList.add('pulse');
            setTimeout(function() { dot.classList.remove('pulse'); }, 1000);
        });
        evtSource.onopen = function() {
            dot.classList.add('connected');
        };
        evtSource.onerror = function() {
            dot.classList.remove('connected');
        };
    })();
    </script>
</body>
</html>
